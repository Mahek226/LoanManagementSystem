<div class="enhanced-dashboard">
  <!-- Welcome Banner -->
  <div class="welcome-banner">
    <div class="container-fluid px-4 py-4">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h2 class="welcome-title mb-2">Welcome back, {{ userName }}! ðŸ‘‹</h2>
          <p class="welcome-subtitle mb-0">Here's your loan application overview and latest updates</p>
        </div>
        <div class="col-md-4 text-md-end">
          <div class="last-updated">
            <i class="fas fa-sync-alt me-2"></i>
            <small>Auto-refreshing every 30s</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid px-4 py-4">
    <!-- Profile Summary Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card profile-summary-card">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-md-3 text-center mb-3 mb-md-0">
                <div class="profile-avatar">
                  <i class="fas fa-user-circle"></i>
                </div>
                <h5 class="mt-3 mb-1">{{ userName }}</h5>
                <p class="text-muted small mb-0" *ngIf="profile">{{ profile.email }}</p>
              </div>
              
              <div class="col-md-9">
                <div class="row g-3">
                  <!-- Email Verification -->
                  <div class="col-sm-6 col-lg-3">
                    <div class="verification-badge" [class.verified]="profile?.isEmailVerified">
                      <i class="fas" [ngClass]="profile?.isEmailVerified ? 'fa-check-circle' : 'fa-times-circle'"></i>
                      <div class="ms-2">
                        <small class="d-block text-muted">Email</small>
                        <strong>{{ profile?.isEmailVerified ? 'Verified' : 'Not Verified' }}</strong>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Account Status -->
                  <div class="col-sm-6 col-lg-3">
                    <div class="verification-badge" [class.verified]="profile?.isApproved">
                      <i class="fas" [ngClass]="profile?.isApproved ? 'fa-check-circle' : 'fa-clock'"></i>
                      <div class="ms-2">
                        <small class="d-block text-muted">Account</small>
                        <strong>{{ profile?.approvalStatus || 'Pending' }}</strong>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Phone -->
                  <div class="col-sm-6 col-lg-3">
                    <div class="verification-badge" [class.verified]="profile?.phone">
                      <i class="fas fa-phone"></i>
                      <div class="ms-2">
                        <small class="d-block text-muted">Phone</small>
                        <strong>{{ profile?.phone || 'Not Added' }}</strong>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Member Since -->
                  <div class="col-sm-6 col-lg-3">
                    <div class="verification-badge verified">
                      <i class="fas fa-calendar"></i>
                      <div class="ms-2">
                        <small class="d-block text-muted">Member Since</small>
                        <strong *ngIf="profile">{{ formatDate(profile.createdAt) }}</strong>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pre-Qualification Status -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card pre-qualification-card" [ngClass]="getPreQualificationClass()">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-md-8">
                <div class="d-flex align-items-center mb-3">
                  <div class="pre-qual-icon">
                    <i class="fas" [ngClass]="getPreQualificationIcon()"></i>
                  </div>
                  <div class="ms-3">
                    <h4 class="mb-1 text-white">Pre-Qualification Status</h4>
                    <p class="mb-0 text-white-50" *ngIf="preQualification">{{ preQualification.message }}</p>
                  </div>
                </div>
                
                <div class="verified-fields" *ngIf="preQualification">
                  <h6 class="text-white mb-2">Verified Fields:</h6>
                  <div class="d-flex flex-wrap gap-2">
                    <span class="field-badge" [class.verified]="preQualification.verifiedFields.email">
                      <i class="fas fa-envelope me-1"></i> Email
                    </span>
                    <span class="field-badge" [class.verified]="preQualification.verifiedFields.phone">
                      <i class="fas fa-phone me-1"></i> Phone
                    </span>
                    <span class="field-badge" [class.verified]="preQualification.verifiedFields.identity">
                      <i class="fas fa-id-card me-1"></i> Identity
                    </span>
                    <span class="field-badge" [class.verified]="preQualification.verifiedFields.income">
                      <i class="fas fa-money-bill me-1"></i> Income
                    </span>
                    <span class="field-badge" [class.verified]="preQualification.verifiedFields.employment">
                      <i class="fas fa-briefcase me-1"></i> Employment
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4 text-center">
                <div class="estimated-loan" *ngIf="preQualification">
                  <small class="d-block text-white-50 mb-1">Estimated Max Loan</small>
                  <h2 class="text-white mb-3">{{ formatCurrency(preQualification.estimatedMaxLoan) }}</h2>
                  <button class="btn btn-light btn-sm" (click)="navigateToLoanTypes()" *ngIf="preQualification.isEligible">
                    <i class="fas fa-arrow-right me-2"></i>Apply Now
                  </button>
                  <button class="btn btn-outline-light btn-sm" (click)="navigateToDocuments()" *ngIf="!preQualification.isEligible">
                    <i class="fas fa-upload me-2"></i>Upload Documents
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Required Documents -->
            <div class="required-docs mt-3" *ngIf="preQualification && preQualification.requiredDocuments.length > 0">
              <h6 class="text-white mb-2">Required Documents:</h6>
              <div class="d-flex flex-wrap gap-2">
                <span class="doc-badge" *ngFor="let doc of preQualification.requiredDocuments">
                  <i class="fas fa-file-alt me-1"></i>{{ doc }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="stat-card stat-card-primary">
          <div class="stat-icon">
            <i class="fas fa-file-alt"></i>
          </div>
          <div class="stat-content">
            <h3>{{ applications.length }}</h3>
            <p>Total Applications</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="stat-card stat-card-warning">
          <div class="stat-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-content">
            <h3>{{ activeApplications.length }}</h3>
            <p>Active Applications</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="stat-card stat-card-success">
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ applicationHistory.length }}</h3>
            <p>Completed</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="stat-card stat-card-info">
          <div class="stat-icon">
            <i class="fas fa-bell"></i>
          </div>
          <div class="stat-content">
            <h3>{{ unreadCount }}</h3>
            <p>Notifications</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Row -->
    <div class="row">
      <!-- Active Applications & History -->
      <div class="col-lg-8 mb-4">
        <!-- Active Applications -->
        <div class="card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-tasks me-2"></i>Active Applications
            </h5>
            <button class="btn btn-sm btn-primary" (click)="navigateToApplications()">
              View All <i class="fas fa-arrow-right ms-1"></i>
            </button>
          </div>
          <div class="card-body">
            <div *ngIf="loading.applications" class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
            
            <div *ngIf="!loading.applications && activeApplications.length === 0" class="empty-state">
              <i class="fas fa-inbox"></i>
              <p>No active applications</p>
              <button class="btn btn-primary btn-sm" (click)="navigateToLoanTypes()">
                <i class="fas fa-plus me-2"></i>Start New Application
              </button>
            </div>
            
            <div class="application-list" *ngIf="!loading.applications && activeApplications.length > 0">
              <div class="application-item" *ngFor="let app of activeApplications.slice(0, 3)">
                <div class="row align-items-center">
                  <div class="col-md-8">
                    <div class="d-flex align-items-center mb-2">
                      <span class="loan-type-badge">{{ app.loanType }}</span>
                      <span class="badge ms-2" [ngClass]="'bg-' + getStatusColor(app.loanStatus)">
                        {{ app.loanStatus }}
                      </span>
                    </div>
                    <h6 class="mb-1">{{ formatCurrency(app.loanAmount) }} for {{ app.loanTenure }} months</h6>
                    <small class="text-muted">
                      <i class="fas fa-calendar me-1"></i>Applied: {{ formatDate(app.applicationDate) }}
                    </small>
                  </div>
                  <div class="col-md-4 text-md-end mt-2 mt-md-0">
                    <button class="btn btn-sm btn-outline-primary" (click)="viewApplication(app.loanId)">
                      <i class="fas fa-eye me-1"></i>View Details
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Application History -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-history me-2"></i>Application History
            </h5>
          </div>
          <div class="card-body">
            <div *ngIf="applicationHistory.length === 0" class="empty-state-small">
              <i class="fas fa-history"></i>
              <p>No application history</p>
            </div>
            
            <div class="table-responsive" *ngIf="applicationHistory.length > 0">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Loan Type</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let app of applicationHistory.slice(0, 5)">
                    <td>{{ app.loanType }}</td>
                    <td>{{ formatCurrency(app.loanAmount) }}</td>
                    <td>
                      <span class="badge" [ngClass]="'bg-' + getStatusColor(app.loanStatus)">
                        {{ app.loanStatus }}
                      </span>
                    </td>
                    <td>{{ formatDate(app.applicationDate) }}</td>
                    <td>
                      <button class="btn btn-sm btn-link" (click)="viewApplication(app.loanId)">
                        View
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Notifications & Action Items -->
      <div class="col-lg-4 mb-4">
        <div class="card notifications-card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-bell me-2"></i>Notifications
              <span class="badge bg-danger ms-2" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
            </h5>
          </div>
          <div class="card-body p-0">
            <div *ngIf="loading.notifications" class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
            
            <div *ngIf="!loading.notifications && notifications.length === 0" class="empty-state-small p-4">
              <i class="fas fa-bell-slash"></i>
              <p>No notifications</p>
            </div>
            
            <div class="notification-list" *ngIf="!loading.notifications && notifications.length > 0">
              <div class="notification-item" 
                   *ngFor="let notification of notifications"
                   [class.unread]="!notification.isRead"
                   (click)="markAsRead(notification)">
                <div class="d-flex align-items-start">
                  <div class="notification-icon">
                    <i class="fas" [ngClass]="getNotificationIcon(notification.type)"></i>
                  </div>
                  <div class="notification-content flex-grow-1">
                    <div class="d-flex justify-content-between align-items-start mb-1">
                      <h6 class="mb-0">{{ notification.title }}</h6>
                      <span [ngClass]="getNotificationPriorityBadge(notification.priority)">
                        {{ notification.priority }}
                      </span>
                    </div>
                    <p class="mb-2">{{ notification.message }}</p>
                    <div class="d-flex justify-content-between align-items-center">
                      <small class="text-muted">{{ getTimeAgo(notification.timestamp) }}</small>
                      <button class="btn btn-sm btn-link p-0" 
                              *ngIf="notification.actionUrl"
                              (click)="handleNotificationAction(notification)">
                        {{ notification.actionText || 'View' }} <i class="fas fa-arrow-right ms-1"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
