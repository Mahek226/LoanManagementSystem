<div class="progress-tracker" *ngIf="!loading && progress">
  <!-- Progress Header -->
  <div class="progress-header">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h5 class="mb-1">Application Progress</h5>
        <p class="text-muted mb-0">Track your loan application status in real-time</p>
      </div>
      <div class="text-end">
        <div class="progress-percentage">
          <span class="percentage-value">{{ progress.overallProgress }}%</span>
          <small class="d-block text-muted">Complete</small>
        </div>
      </div>
    </div>
    
    <!-- Overall Progress Bar -->
    <div class="overall-progress">
      <div class="progress" style="height: 8px;">
        <div class="progress-bar progress-bar-striped progress-bar-animated" 
             role="progressbar" 
             [style.width.%]="progress.overallProgress"
             [attr.aria-valuenow]="progress.overallProgress"
             aria-valuemin="0" 
             aria-valuemax="100">
        </div>
      </div>
      <div class="d-flex justify-content-between mt-2">
        <small class="text-muted">
          <i class="fas fa-tasks me-1"></i>
          Step {{ progress.currentStep }} of {{ progress.totalSteps }}
        </small>
        <small class="text-muted" *ngIf="progress.estimatedCompletion">
          <i class="fas fa-calendar me-1"></i>
          Est. completion: {{ formatDate(progress.estimatedCompletion) }}
        </small>
      </div>
    </div>
  </div>

  <!-- Progress Steps -->
  <div class="progress-steps">
    <div class="step-item" 
         *ngFor="let step of progress.steps; let i = index; let last = last"
         [ngClass]="getStepClass(step.status)">
      
      <!-- Step Connector Line -->
      <div class="step-connector" *ngIf="!last"></div>
      
      <!-- Step Content -->
      <div class="step-content">
        <!-- Step Icon -->
        <div class="step-icon-wrapper">
          <div class="step-icon">
            <i class="fas" [ngClass]="getStepIcon(step.status)"></i>
          </div>
          <div class="step-number">{{ step.stepNumber }}</div>
        </div>
        
        <!-- Step Details -->
        <div class="step-details">
          <h6 class="step-name">{{ step.stepName }}</h6>
          <p class="step-description">{{ step.description }}</p>
          
          <!-- Step Status Badge -->
          <div class="step-status-badge" *ngIf="step.status === 'COMPLETED' && step.completedAt">
            <i class="fas fa-check-circle me-1"></i>
            Completed on {{ formatDate(step.completedAt) }}
          </div>
          <div class="step-status-badge in-progress" *ngIf="step.status === 'IN_PROGRESS'">
            <i class="fas fa-spinner fa-spin me-1"></i>
            In Progress
          </div>
          <div class="step-status-badge pending" *ngIf="step.status === 'PENDING'">
            <i class="fas fa-clock me-1"></i>
            Pending
          </div>
          <div class="step-status-badge failed" *ngIf="step.status === 'FAILED'">
            <i class="fas fa-exclamation-circle me-1"></i>
            Failed - Action Required
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Progress Footer -->
  <div class="progress-footer mt-4">
    <div class="alert alert-info d-flex align-items-center">
      <i class="fas fa-info-circle me-3 fs-4"></i>
      <div>
        <strong>What's Next?</strong>
        <p class="mb-0 mt-1">
          <span *ngIf="progress.currentStep === 2">
            We are currently verifying your documents. You will receive an email notification once this step is complete.
          </span>
          <span *ngIf="progress.currentStep === 3">
            Your credit assessment is in progress. This typically takes 1-2 business days.
          </span>
          <span *ngIf="progress.currentStep === 4">
            A loan officer is reviewing your application. You may be contacted for additional information.
          </span>
          <span *ngIf="progress.currentStep === 5">
            Your application is in the final approval stage. You will be notified of the decision soon.
          </span>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="text-center py-5" *ngIf="loading">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading progress...</span>
  </div>
  <p class="mt-3 text-muted">Loading application progress...</p>
</div>
