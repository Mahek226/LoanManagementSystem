<!-- Dashboard Content -->

<!-- Loading State -->
<div *ngIf="loading" class="text-center py-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3 text-muted">Loading dashboard...</p>
</div>

<!-- Error State -->
<div *ngIf="error && !loading && !stats" class="container-fluid py-4">
  <div class="alert alert-warning">
    <i class="fas fa-info-circle me-2"></i>{{ error }}
  </div>
</div>

<!-- Main Content -->
<div class="container-fluid px-4 py-4" *ngIf="!loading && stats">
  
  <!-- Welcome Banner -->
  <div class="welcome-banner mb-4 p-4 rounded-3 shadow-sm animate-fade-in" 
       style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="d-flex justify-content-between align-items-center text-white">
      <div>
        <h2 class="h4 fw-bold mb-2">Welcome back, {{ officerName }}! ðŸ‘‹</h2>
        <p class="mb-0 opacity-90">Here's what's happening with your loan assignments today</p>
      </div>
      <button class="btn btn-light" (click)="viewAllLoans()">
        <i class="fas fa-tasks me-2"></i>View All Assignments
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
      <div class="stat-card card border-0 shadow-sm animate-slide-up" style="animation-delay: 0.1s; background-color: var(--bg-primary);">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted mb-2 small">Total Assigned</p>
              <h3 class="fw-bold mb-0 counter" style="color: var(--text-primary);">{{ stats.totalAssigned }}</h3>
            </div>
            <div class="stat-icon bg-primary bg-opacity-10 rounded-3 p-3">
              <i class="fas fa-briefcase text-primary fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="stat-card card border-0 shadow-sm animate-slide-up" style="animation-delay: 0.2s; background-color: var(--bg-primary);">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted mb-2 small">Pending Review</p>
              <h3 class="fw-bold mb-0 counter text-warning">{{ stats.pendingReview }}</h3>
            </div>
            <div class="stat-icon bg-warning bg-opacity-10 rounded-3 p-3">
              <i class="fas fa-clock text-warning fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="stat-card card border-0 shadow-sm animate-slide-up" style="animation-delay: 0.3s; background-color: var(--bg-primary);">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted mb-2 small">Approved</p>
              <h3 class="fw-bold mb-0 counter text-success">{{ stats.approved }}</h3>
            </div>
            <div class="stat-icon bg-success bg-opacity-10 rounded-3 p-3">
              <i class="fas fa-check-circle text-success fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="stat-card card border-0 shadow-sm animate-slide-up" style="animation-delay: 0.4s; background-color: var(--bg-primary);">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted mb-2 small">High Risk</p>
              <h3 class="fw-bold mb-0 counter text-danger">{{ stats.highRiskCount }}</h3>
            </div>
            <div class="stat-icon bg-danger bg-opacity-10 rounded-3 p-3">
              <i class="fas fa-exclamation-triangle text-danger fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row g-4 mb-4">
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm animate-fade-in" style="animation-delay: 0.5s; background-color: var(--bg-primary);">
        <div class="card-header border-0 pb-0" style="background-color: var(--bg-primary);">
          <h5 class="fw-semibold mb-0" style="color: var(--text-primary);">
            <i class="fas fa-chart-pie me-2 text-primary"></i>Status Distribution
          </h5>
        </div>
        <div class="card-body">
          <div style="height: 300px; position: relative;">
            <canvas id="statusChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card border-0 shadow-sm animate-fade-in" style="animation-delay: 0.6s; background-color: var(--bg-primary);">
        <div class="card-header border-0 pb-0" style="background-color: var(--bg-primary);">
          <h5 class="fw-semibold mb-0" style="color: var(--text-primary);">
            <i class="fas fa-chart-bar me-2 text-primary"></i>Risk Level Distribution
          </h5>
        </div>
        <div class="card-body">
          <div style="height: 300px; position: relative;">
            <canvas id="riskChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Assignments -->
  <div class="card border-0 shadow-sm animate-fade-in" style="animation-delay: 0.7s; background-color: var(--bg-primary);">
    <div class="card-header border-0 d-flex justify-content-between align-items-center" style="background-color: var(--bg-primary);">
      <h5 class="fw-semibold mb-0" style="color: var(--text-primary);">
        <i class="fas fa-list me-2 text-primary"></i>Recent Assignments
      </h5>
      <button class="btn btn-sm btn-outline-primary" (click)="viewAllLoans()">
        View All <i class="fas fa-arrow-right ms-1"></i>
      </button>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead style="background-color: var(--bg-secondary);">
            <tr>
              <th style="color: var(--text-primary);">Applicant</th>
              <th style="color: var(--text-primary);">Loan Type</th>
              <th style="color: var(--text-primary);">Amount</th>
              <th style="color: var(--text-primary);">Risk Level</th>
              <th style="color: var(--text-primary);">Status</th>
              <th style="color: var(--text-primary);">Assigned Date</th>
              <th style="color: var(--text-primary);">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let loan of recentLoans" class="loan-row">
              <td style="color: var(--text-primary);">
                <div class="d-flex align-items-center">
                  <div class="avatar-sm bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-2">
                    <i class="fas fa-user text-primary"></i>
                  </div>
                  <div>
                    <div class="fw-semibold">{{ loan.applicantName }}</div>
                    <small class="text-muted">ID: {{ loan.applicantId }}</small>
                  </div>
                </div>
              </td>
              <td style="color: var(--text-primary);">
                <span class="badge bg-info">{{ loan.loanType }}</span>
              </td>
              <td style="color: var(--text-primary);">
                <span class="fw-semibold">{{ formatCurrency(loan.loanAmount) }}</span>
              </td>
              <td>
                <span class="badge bg-{{ getRiskColor(loan.riskLevel) }}">
                  <i class="fas fa-circle-notch fa-spin me-1" *ngIf="loan.riskLevel === 'HIGH'"></i>
                  {{ loan.riskLevel }}
                </span>
              </td>
              <td>
                <span class="badge bg-{{ getStatusColor(loan.status) }}">{{ loan.status }}</span>
              </td>
              <td style="color: var(--text-secondary);">{{ formatDate(loan.assignedAt) }}</td>
              <td>
                <button class="btn btn-sm btn-primary" (click)="reviewLoan(loan.assignmentId)">
                  <i class="fas fa-eye me-1"></i>Review
                </button>
              </td>
            </tr>
            <tr *ngIf="recentLoans.length === 0">
              <td colspan="7" class="text-center text-muted py-4">
                <i class="fas fa-inbox fs-3 mb-2 d-block"></i>
                No recent assignments
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
