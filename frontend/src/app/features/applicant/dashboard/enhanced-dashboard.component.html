<div class="enhanced-dashboard">
  <!-- Welcome Banner -->
  <div class="welcome-banner">
    <div class="container-fluid px-4 py-4">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h2 class="welcome-title mb-2">Welcome back, {{ userName }}! ðŸ‘‹</h2>
          <p class="welcome-subtitle mb-0">Here's your loan application overview and latest updates</p>
        </div>
        <div class="col-md-4 text-md-end">
          <div class="last-updated">
            <i class="fas fa-clock me-2"></i>
            <small>Last updated: {{ lastUpdated | date:'short' }}</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid px-4 py-4">
    <!-- Profile Summary Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card profile-summary-card">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-md-3 text-center mb-3 mb-md-0">
                <div class="profile-avatar">
                  <i class="fas fa-user-circle"></i>
                </div>
                <h5 class="mt-3 mb-1">{{ userName }}</h5>
                <p class="text-muted small mb-0" *ngIf="profile">{{ profile.email }}</p>
              </div>
              
              <div class="col-md-9">
                <div class="row g-3">
                  <!-- Email Verification -->
                  <div class="col-sm-6 col-lg-3">
                    <div class="verification-badge" [class.verified]="profile?.isEmailVerified">
                      <i class="fas" [ngClass]="profile?.isEmailVerified ? 'fa-check-circle' : 'fa-times-circle'"></i>
                      <div class="ms-2">
                        <small class="d-block text-muted">Email</small>
                        <strong>{{ profile?.isEmailVerified ? 'Verified' : 'Not Verified' }}</strong>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Account Status -->
                  <div class="col-sm-6 col-lg-3">
                    <div class="verification-badge" [class.verified]="profile?.isApproved">
                      <i class="fas" [ngClass]="profile?.isApproved ? 'fa-check-circle' : 'fa-clock'"></i>
                      <div class="ms-2">
                        <small class="d-block text-muted">Account</small>
                        <strong>{{ profile?.approvalStatus || 'Pending' }}</strong>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Phone -->
                  <div class="col-sm-6 col-lg-3">
                    <div class="verification-badge" [class.verified]="profile?.phone">
                      <i class="fas fa-phone"></i>
                      <div class="ms-2">
                        <small class="d-block text-muted">Phone</small>
                        <strong>{{ profile?.phone || 'Not Added' }}</strong>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Member Since -->
                  <div class="col-sm-6 col-lg-3">
                    <div class="verification-badge verified">
                      <i class="fas fa-calendar"></i>
                      <div class="ms-2">
                        <small class="d-block text-muted">Member Since</small>
                        <strong *ngIf="profile">{{ formatDate(profile.createdAt) }}</strong>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    

    <!-- Enhanced Statistics Cards - Properly Aligned -->
    <div class="row g-4 mb-4">
      <div class="col-xl-3 col-md-6 col-sm-6">
        <div class="card border-0 shadow-sm h-100 stat-card-enhanced">
          <div class="card-body p-4">
            <div class="d-flex align-items-center justify-content-between">
              <div class="stat-content">
                <div class="stat-icon-wrapper bg-primary bg-opacity-10 rounded-circle p-3 mb-3">
                  <i class="fas fa-file-alt text-primary fs-3"></i>
                </div>
                <h6 class="text-muted mb-2 fw-normal">Total Applications</h6>
                <h2 class="mb-1 fw-bold text-primary">{{ applications.length }}</h2>
                <small class="text-muted">
                  <i class="fas fa-chart-line me-1"></i>All time
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 col-sm-6">
        <div class="card border-0 shadow-sm h-100 stat-card-enhanced">
          <div class="card-body p-4">
            <div class="d-flex align-items-center justify-content-between">
              <div class="stat-content">
                <div class="stat-icon-wrapper bg-warning bg-opacity-10 rounded-circle p-3 mb-3">
                  <i class="fas fa-hourglass-half text-warning fs-3"></i>
                </div>
                <h6 class="text-muted mb-2 fw-normal">Active Applications</h6>
                <h2 class="mb-1 fw-bold text-warning">{{ activeApplications.length }}</h2>
                <small class="text-muted">
                  <i class="fas fa-clock me-1"></i>In Progress
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 col-sm-6">
        <div class="card border-0 shadow-sm h-100 stat-card-enhanced">
          <div class="card-body p-4">
            <div class="d-flex align-items-center justify-content-between">
              <div class="stat-content">
                <div class="stat-icon-wrapper bg-success bg-opacity-10 rounded-circle p-3 mb-3">
                  <i class="fas fa-check-circle text-success fs-3"></i>
                </div>
                <h6 class="text-muted mb-2 fw-normal">Completed</h6>
                <h2 class="mb-1 fw-bold text-success">{{ applicationHistory.length }}</h2>
                <small class="text-muted">
                  <i class="fas fa-thumbs-up me-1"></i>Success
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 col-sm-6">
        <div class="card border-0 shadow-sm h-100 stat-card-enhanced">
          <div class="card-body p-4">
            <div class="d-flex align-items-center justify-content-between">
              <div class="stat-content">
                <div class="stat-icon-wrapper bg-info bg-opacity-10 rounded-circle p-3 mb-3">
                  <i class="fas fa-coins text-info fs-3"></i>
                </div>
                <h6 class="text-muted mb-2 fw-normal">Total Amount</h6>
                <h2 class="mb-1 fw-bold text-info">{{ formatCurrency(getTotalAppliedAmount()) }}</h2>
                <small class="text-muted">
                  <i class="fas fa-money-bill-wave me-1"></i>Applied
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Row -->
    <div class="row">
      <!-- Active Applications & History -->
      <div class="col-lg-8 mb-4">

        <!-- Applications Management with Tabs -->
        <div class="card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-folder-open me-2"></i>Applications Management
            </h5>
            <button class="btn btn-sm btn-primary" (click)="navigateToApplications()">
              View All <i class="fas fa-arrow-right ms-1"></i>
            </button>
          </div>
          
          <!-- Application Tabs -->
          <div class="card-body p-0">
            <ul class="nav nav-tabs nav-tabs-enhanced" id="applicationTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="active-tab" data-bs-toggle="tab" data-bs-target="#active-applications" 
                        type="button" role="tab" aria-controls="active-applications" aria-selected="true">
                  <i class="fas fa-tasks me-2"></i>Active Applications
                  <span class="badge bg-primary ms-2">{{ activeApplications.length }}</span>
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="drafts-tab" data-bs-toggle="tab" data-bs-target="#draft-applications" 
                        type="button" role="tab" aria-controls="draft-applications" aria-selected="false">
                  <i class="fas fa-edit me-2"></i>Drafts
                  <span class="badge bg-warning ms-2">{{ draftApplications.length }}</span>
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="resubmission-tab" data-bs-toggle="tab" data-bs-target="#document-resubmission" 
                        type="button" role="tab" aria-controls="document-resubmission" aria-selected="false">
                  <i class="fas fa-exclamation-triangle me-2"></i>Document Resubmission
                  <span class="badge bg-danger ms-2">{{ documentResubmissionRequests.length }}</span>
                </button>
              </li>
            </ul>
            
            <div class="tab-content" id="applicationTabContent">
              <!-- Active Applications Tab -->
              <div class="tab-pane fade show active" id="active-applications" role="tabpanel" aria-labelledby="active-tab">
                <div class="p-4">
                  <div *ngIf="loading.applications" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  </div>
                  
                  <div *ngIf="!loading.applications && activeApplications.length === 0" class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>No active applications</p>
                    <button class="btn btn-primary btn-sm" (click)="navigateToLoanTypes()">
                      <i class="fas fa-plus me-2"></i>Start New Application
                    </button>
                  </div>
                  
                  <div class="application-list" *ngIf="!loading.applications && activeApplications.length > 0">
                    <div class="application-card" *ngFor="let app of activeApplications.slice(0, 3)">
                      <div class="card border-0 shadow-sm mb-3">
                        <div class="card-body p-4">
                          <div class="row align-items-center">
                            <div class="col-md-8">
                              <!-- Header with Loan Type and Status -->
                              <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="d-flex align-items-center">
                                  <div class="loan-type-icon me-3">
                                    <i class="fas {{ getLoanTypeIcon(app.loanType) }} fa-2x text-primary"></i>
                                  </div>
                                  <div>
                                    <h5 class="mb-1 fw-bold text-dark">{{ app.loanType }} Loan</h5>
                                    <span class="badge" [ngClass]="'bg-' + getStatusColor(app.loanStatus)">
                                      <i class="fas fa-circle me-1" style="font-size: 0.6em;"></i>{{ app.loanStatus }}
                                    </span>
                                  </div>
                                </div>
                              </div>
                              
                              <!-- Dummy Loan ID Display -->
                              <div class="mb-3">
                                <div class="d-flex align-items-center">
                                  <i class="fas fa-id-card text-muted me-2"></i>
                                  <div>
                                    <small class="text-muted d-block">Loan ID</small>
                                    <strong class="text-dark">{{ generateDummyLoanId(app.loanId) }}</strong>
                                  </div>
                                </div>
                              </div>
                              
                              <!-- Loan Details Grid -->
                              <div class="row g-3 mb-3">
                                <div class="col-sm-6">
                                  <div class="detail-item">
                                    <i class="fas fa-coins text-success me-2"></i>
                                    <div>
                                      <small class="text-muted d-block">Loan Amount</small>
                                      <strong class="text-success">{{ formatCurrency(app.loanAmount) }}</strong>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-sm-6">
                                  <div class="detail-item">
                                    <i class="fas fa-calendar-alt text-info me-2"></i>
                                    <div>
                                      <small class="text-muted d-block">Tenure</small>
                                      <strong class="text-info">{{ getTenureDisplay(app) }} months</strong>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              
                              <!-- Application Date -->
                              <div class="d-flex align-items-center text-muted">
                                <i class="fas fa-clock me-2"></i>
                                <small>Applied on {{ formatDate(app.applicationDate) }}</small>
                              </div>
                            </div>
                            
                            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                              <div class="d-flex flex-column gap-2">
                                <button class="btn btn-primary btn-sm" (click)="viewApplication(app.loanId)">
                                  <i class="fas fa-eye me-2"></i>View Details
                                </button>
                                <button class="btn btn-outline-primary btn-sm" (click)="downloadApplicationPDF(app.loanId)">
                                  <i class="fas fa-download me-2"></i>Download
                                </button>
                                <div class="mt-2">
                                  <small class="text-muted d-block">Interest Rate</small>
                                  <strong class="text-warning">{{ getInterestRate(app) }}% p.a.</strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Draft Applications Tab -->
              <div class="tab-pane fade" id="draft-applications" role="tabpanel" aria-labelledby="drafts-tab">
                <div class="p-4">
                  <!-- No Drafts Message -->
                  <div *ngIf="draftApplications.length === 0" class="empty-state">
                    <i class="fas fa-edit"></i>
                    <p>No Draft Applications</p>
                    <small class="text-muted d-block mb-3">Start a new loan application and save it as draft to see it here.</small>
                    <button class="btn btn-warning btn-sm" (click)="navigateToLoanTypes()">
                      <i class="fas fa-plus me-1"></i>Start New Application
                    </button>
                  </div>
                  
                  <!-- Draft Cards -->
                  <div class="row g-3" *ngIf="draftApplications.length > 0">
                    <div class="col-md-6 col-xl-4" *ngFor="let draft of draftApplications">
                      <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); border-left: 4px solid #f39c12 !important;">
                        <div class="card-body">
                          <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title mb-0 text-dark fw-bold">{{ draft.title }}</h6>
                            <button class="btn btn-sm btn-outline-danger" (click)="deleteDraft(draft.id)" title="Delete Draft">
                              <i class="fas fa-times"></i>
                            </button>
                          </div>
                          <p class="card-text small text-muted mb-2">{{ draft.description }}</p>
                          
                          <!-- Progress Bar -->
                          <div class="mb-3">
                            <div class="d-flex justify-content-between small mb-1">
                              <span class="text-muted">Progress</span>
                              <span class="fw-bold text-warning">{{ draft.completionPercentage }}%</span>
                            </div>
                            <div class="progress" style="height: 6px;">
                              <div class="progress-bar bg-warning" 
                                   role="progressbar" 
                                   [style.width.%]="draft.completionPercentage"
                                   [attr.aria-valuenow]="draft.completionPercentage"
                                   aria-valuemin="0" 
                                   aria-valuemax="100"></div>
                            </div>
                          </div>
                          
                          <!-- Draft Info -->
                          <div class="row g-2 mb-3">
                            <div class="col-6">
                              <small class="text-muted d-block">Current Step</small>
                              <strong class="text-dark">{{ getStepName(draft.currentStep) }}</strong>
                            </div>
                            <div class="col-6">
                              <small class="text-muted d-block">Last Saved</small>
                              <strong class="text-dark">{{ getTimeSinceLastSaved(draft.lastSaved) }}</strong>
                            </div>
                          </div>
                          
                          <!-- Action Button -->
                          <button class="btn btn-warning w-100" (click)="resumeDraft(draft.id)">
                            <i class="fas fa-play me-2"></i>Resume Application
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Document Resubmission Tab -->
              <div class="tab-pane fade" id="document-resubmission" role="tabpanel" aria-labelledby="resubmission-tab">
                <div class="p-4">
                  <div class="alert alert-warning mb-3" *ngIf="documentResubmissionRequests.length > 0">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Action Required:</strong> The following documents need to be resubmitted as requested by your loan officer.
                  </div>
                  
                  <!-- Empty state when no requests -->
                  <div *ngIf="documentResubmissionRequests.length === 0" class="text-center py-4">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <h6 class="text-muted">No Document Resubmission Requests</h6>
                    <p class="small text-muted mb-0">All your documents are currently approved. No action required.</p>
                  </div>
                  
                  <!-- Requests list -->
                  <div class="row g-3" *ngIf="documentResubmissionRequests.length > 0">
                    <div class="col-md-6 col-xl-4" *ngFor="let request of documentResubmissionRequests">
                      <div class="card border-0 shadow-sm h-100" 
                           [class]="'border-start border-4 border-' + getResubmissionStatusColor(request.status)"
                           style="background: linear-gradient(135deg, #fff5f5 0%, #ffe6e6 100%);">
                        <div class="card-body">
                          <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="d-flex align-items-center">
                              <i class="fas {{ getDocumentIcon(request.requestedDocuments) }} fa-2x me-3 text-danger"></i>
                              <div>
                                <h6 class="card-title mb-0 text-dark fw-bold">{{ getDocumentDisplayName(request.requestedDocuments) }}</h6>
                                <small class="text-muted">Loan ID: {{ generateDummyLoanId(request.loanId) }}</small>
                              </div>
                            </div>
                            <span class="badge bg-{{ getResubmissionStatusColor(request.status) }}">{{ request.status }}</span>
                          </div>
                          
                          <!-- Rejection Reason -->
                          <div class="mb-3">
                            <small class="text-muted d-block mb-1">Reason for Resubmission:</small>
                            <p class="small text-dark mb-0">{{ request.message }}</p>
                          </div>
                          
                          <!-- Request Details -->
                          <div class="mb-3">
                            <small class="text-muted d-block">Requested On</small>
                            <strong class="small text-dark">{{ formatResubmissionDate(request.requestedAt) }}</strong>
                          </div>
                          
                          <!-- Due Date Warning -->
                          <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                              <small class="text-muted">Due Date:</small>
                              <span class="small fw-bold" 
                                    [class]="isOverdue(request.dueDate) ? 'text-danger' : (getDaysRemaining(request.dueDate) <= 2 ? 'text-warning' : 'text-success')">
                                <i class="fas fa-clock me-1"></i>
                                <span *ngIf="!isOverdue(request.dueDate)">{{ getDaysRemaining(request.dueDate) }} days left</span>
                                <span *ngIf="isOverdue(request.dueDate)">{{ getAbsoluteDays(getDaysRemaining(request.dueDate)) }} days overdue</span>
                              </span>
                            </div>
                            <div class="progress mt-1" style="height: 4px;">
                              <div class="progress-bar" 
                                   [class]="isOverdue(request.dueDate) ? 'bg-danger' : (getDaysRemaining(request.dueDate) <= 2 ? 'bg-warning' : 'bg-success')"
                                   [style.width.%]="getProgressBarWidth(request.dueDate)"></div>
                            </div>
                          </div>
                          
                          <!-- Action Buttons -->
                          <div class="d-flex gap-2">
                            <button class="btn btn-danger btn-sm flex-fill" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#resubmissionModal"
                                    (click)="openResubmissionModal(request)">
                              <i class="fas fa-upload me-1"></i>Resubmit Document
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" (click)="dismissResubmissionRequest(request.notificationId)" 
                                    title="Dismiss this request">
                              <i class="fas fa-times"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Application History -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-history me-2"></i>Application History
            </h5>
          </div>
          <div class="card-body">
            <div *ngIf="applicationHistory.length === 0" class="empty-state-small">
              <i class="fas fa-history"></i>
              <p>No application history</p>
            </div>
            
            <div class="table-responsive" *ngIf="applicationHistory.length > 0">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Loan Type</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let app of applicationHistory.slice(0, 5)">
                    <td>
                      <div class="fw-semibold">{{ app.loanType }}</div>
                      <small class="text-muted">ID: {{ app.loanId }}</small>
                    </td>
                    <td>
                      <div class="fw-semibold">{{ formatCurrency(app.loanAmount) }}</div>
                    </td>
                    <td>
                      <span class="badge" [ngClass]="'bg-' + getStatusColor(app.loanStatus)">
                        {{ app.loanStatus }}
                      </span>
                    </td>
                    <td>
                      <div class="fw-semibold">{{ getApplicationDate(app) }}</div>
                      <small class="text-muted" *ngIf="app.submittedAt">Applied</small>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary d-flex align-items-center gap-1" 
                              (click)="viewApplication(app.loanId)"
                              title="View Application Details">
                        <i class="fas fa-eye"></i>
                        <span>View Details</span>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Loan Insights & Analytics -->
      <div class="col-lg-4 mb-4">
        <!-- Loan Summary Card -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-chart-pie me-2"></i>Loan Summary
            </h5>
          </div>
          <div class="card-body">
            <div class="loan-summary-item mb-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <small class="text-muted">Total Applied Amount</small>
                  <h6 class="mb-0">{{ formatCurrency(getTotalAppliedAmount()) }}</h6>
                </div>
                <div class="summary-icon bg-primary">
                  <i class="fas fa-coins text-white"></i>
                </div>
              </div>
            </div>
            
            <div class="loan-summary-item mb-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <small class="text-muted">Approved Amount</small>
                  <h6 class="mb-0 text-success">{{ formatCurrency(getApprovedAmount()) }}</h6>
                </div>
                <div class="summary-icon bg-success">
                  <i class="fas fa-check-circle text-white"></i>
                </div>
              </div>
            </div>
            
            <div class="loan-summary-item mb-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <small class="text-muted">Average Interest Rate</small>
                  <h6 class="mb-0">{{ getAverageInterestRate() }}% p.a.</h6>
                </div>
                <div class="summary-icon bg-info">
                  <i class="fas fa-chart-line text-white"></i>
                </div>
              </div>
            </div>
            
            <div class="loan-summary-item">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <small class="text-muted">Success Rate</small>
                  <h6 class="mb-0 text-primary">{{ getSuccessRate() }}%</h6>
                </div>
                <div class="summary-icon bg-warning">
                  <i class="fas fa-award text-white"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Loan Types Applied -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-th-large me-2"></i>Loan Types Applied
            </h5>
          </div>
          <div class="card-body p-0">
            <div class="loan-type-list">
              <div class="loan-type-item" *ngFor="let loanType of getLoanTypesApplied()">
                <div class="d-flex justify-content-between align-items-center p-3">
                  <div class="d-flex align-items-center">
                    <div class="loan-type-icon" [ngClass]="getLoanTypeIconClass(loanType.type)">
                      <i class="fas" [ngClass]="getLoanTypeIcon(loanType.type)"></i>
                    </div>
                    <div class="ms-3">
                      <h6 class="mb-0">{{ loanType.type }}</h6>
                      <small class="text-muted">{{ loanType.count }} application(s)</small>
                    </div>
                  </div>
                  <div class="text-end">
                    <small class="text-muted d-block">Total Amount</small>
                    <strong>{{ formatCurrency(loanType.totalAmount) }}</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-clock me-2"></i>Recent Activity
            </h5>
          </div>
          <div class="card-body p-0">
            <div class="activity-timeline">
              <div class="activity-item" *ngFor="let activity of getRecentActivity()">
                <div class="d-flex p-3">
                  <div class="activity-icon" [ngClass]="getActivityIconClass(activity.type)">
                    <i class="fas" [ngClass]="getActivityIcon(activity.type)"></i>
                  </div>
                  <div class="ms-3 flex-grow-1">
                    <h6 class="mb-1">{{ activity.title }}</h6>
                    <p class="mb-1 small">{{ activity.description }}</p>
                    <small class="text-muted">
                      <i class="fas fa-clock me-1"></i>{{ getTimeAgo(activity.timestamp) }}
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <!-- <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-bolt me-2"></i>Quick Actions
            </h5>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              <button class="btn btn-primary btn-sm" (click)="navigateToLoanTypes()">
                <i class="fas fa-plus me-2"></i>Apply for New Loan
              </button>
              <button class="btn btn-outline-primary btn-sm" (click)="navigateToApplications()">
                <i class="fas fa-list me-2"></i>View All Applications
              </button>
              <button class="btn btn-outline-info btn-sm" (click)="downloadApplicationReport()">
                <i class="fas fa-download me-2"></i>Download Report
              </button>
            </div>
          </div>
        </div> -->
      </div>

    </div>
  </div>
</div>

<!-- Document Resubmission Modal -->
<div class="modal fade" id="resubmissionModal" tabindex="-1" aria-labelledby="resubmissionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="resubmissionModalLabel">
          <i class="fas fa-exclamation-triangle me-2"></i>Document Resubmission Required
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" (click)="closeResubmissionModal()"></button>
      </div>
      <div class="modal-body" *ngIf="selectedResubmissionRequest">
        <!-- Document Information -->
        <div class="card mb-4">
          <div class="card-header bg-light">
            <h6 class="mb-0">
              <i class="fas {{ getDocumentIcon(selectedResubmissionRequest.requestedDocuments) }} me-2"></i>
              {{ getDocumentDisplayName(selectedResubmissionRequest.requestedDocuments) }}
            </h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <small class="text-muted d-block">Loan ID</small>
                <strong>{{ generateDummyLoanId(selectedResubmissionRequest.loanId) }}</strong>
              </div>
              <div class="col-md-6">
                <small class="text-muted d-block">Due Date</small>
                <strong [class]="isOverdue(selectedResubmissionRequest.dueDate) ? 'text-danger' : 'text-success'">
                  {{ formatResubmissionDate(selectedResubmissionRequest.dueDate) }}
                  <span *ngIf="isOverdue(selectedResubmissionRequest.dueDate)" class="badge bg-danger ms-2">OVERDUE</span>
                </strong>
              </div>
            </div>
          </div>
        </div>

        <!-- Comments from Loan Officer -->
        <div class="card mb-4">
          <div class="card-header bg-warning text-dark">
            <h6 class="mb-0">
              <i class="fas fa-comment-alt me-2"></i>Comments from Loan Officer
            </h6>
          </div>
          <div class="card-body">
            <div class="alert alert-warning mb-3">
              <i class="fas fa-info-circle me-2"></i>
              <strong>Please review the following feedback carefully before resubmitting your document.</strong>
            </div>
            <p class="mb-0">{{ getCleanedMessage(selectedResubmissionRequest.message) }}</p>
          </div>
        </div>

        <!-- Document Upload Section -->
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h6 class="mb-0">
              <i class="fas fa-upload me-2"></i>Upload New Document
            </h6>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="documentFile" class="form-label">Select Document File</label>
              <input type="file" 
                     class="form-control" 
                     id="documentFile" 
                     #fileInput
                     accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                     (change)="onFileSelected($event)">
              <div class="form-text">
                Accepted formats: PDF, JPG, PNG, DOC, DOCX (Max size: 10MB)
              </div>
            </div>
            
            <div class="mb-3" *ngIf="selectedFile">
              <div class="alert alert-info">
                <i class="fas fa-file me-2"></i>
                <strong>Selected File:</strong> {{ selectedFile.name }} ({{ formatFileSize(selectedFile.size) }})
              </div>
            </div>

            <div class="mb-3">
              <label for="applicantComments" class="form-label">Additional Comments (Optional)</label>
              <textarea class="form-control" 
                        id="applicantComments" 
                        rows="3" 
                        [(ngModel)]="applicantComments"
                        placeholder="Add any additional information or clarifications..."></textarea>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="closeResubmissionModal()">
          <i class="fas fa-times me-1"></i>Cancel
        </button>
        <button type="button" 
                class="btn btn-danger" 
                [disabled]="!selectedFile || isUploading"
                (click)="submitResubmission()">
          <span *ngIf="isUploading" class="spinner-border spinner-border-sm me-2" role="status"></span>
          <i *ngIf="!isUploading" class="fas fa-upload me-1"></i>
          {{ isUploading ? 'Uploading...' : 'Submit Document' }}
        </button>
      </div>
    </div>
  </div>
</div>
